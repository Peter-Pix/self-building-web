<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Self-Building Website</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            transition: background-color 0.5s ease, color 0.5s ease;
        }
        
        #commandInput {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border: none;
            outline: none;
            background: transparent;
            font-size: 18px;
            text-align: center;
            width: 80%;
            max-width: 600px;
            padding: 10px;
            color: inherit;
            z-index: 10000;
        }
        
        #commandInput::placeholder {
            color: rgba(128, 128, 128, 0.5);
        }
        
        #canvas {
            width: 100%;
            min-height: 100vh;
            position: relative;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        #scoreDisplay {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            font-size: 24px;
            font-weight: bold;
            display: none;
            z-index: 9999;
        }
        
        #feedback {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            display: none;
            z-index: 9999;
            max-width: 80%;
            text-align: center;
        }

        #settingsPanel {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 20px;
            border-radius: 10px;
            z-index: 9999;
            max-width: 300px;
        }

        #settingsPanel input, #settingsPanel select {
            width: 100%;
            padding: 8px;
            margin: 8px 0;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            border-radius: 5px;
        }

        #settingsPanel button {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #settingsPanel button:hover {
            background: #0056b3;
        }

        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-connected {
            background: #28a745;
        }

        .status-disconnected {
            background: #dc3545;
        }
    </style>
</head>
<body>
    <div id="settingsPanel">
        <h3 style="margin-bottom: 15px;">‚öôÔ∏è AI Settings</h3>
        <label style="font-size: 12px; opacity: 0.8;">Ollama URL</label>
        <input type="text" id="ollamaUrl" value="http://172.20.10.10:11434" placeholder="http://localhost:11434">
        
        <label style="font-size: 12px; opacity: 0.8;">Model</label>
        <select id="modelSelect">
            <option value="llama3:latest">Llama 3</option>
            <option value="dolphin-llama3:latest">Dolphin Llama 3</option>
            <option value="deepseek-r1:8b">DeepSeek R1 (8B)</option>
            <option value="gemma3:1b">Gemma 3 (1B)</option>
            <option value="qwen3:4b">Qwen 3 (4B)</option>
        </select>
        
        <button id="testConnection">
            <span class="status-indicator status-disconnected" id="statusIndicator"></span>
            Test Connection
        </button>
        
        <div style="margin-top: 15px; font-size: 11px; opacity: 0.6;">
            Type commands to build your website. Say "this is done" when finished.
        </div>
    </div>

    <div id="canvas"></div>
    <input type="text" id="commandInput" placeholder="Type your command..." autofocus>
    <div id="scoreDisplay">Score: <span id="score">0</span>/100</div>
    <div id="feedback"></div>

    <script>
        const input = document.getElementById('commandInput');
        const canvas = document.getElementById('canvas');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const scoreElement = document.getElementById('score');
        const feedback = document.getElementById('feedback');
        const ollamaUrl = document.getElementById('ollamaUrl');
        const modelSelect = document.getElementById('modelSelect');
        const statusIndicator = document.getElementById('statusIndicator');
        
        let commands = [];
        let currentScore = 0;
        let isConnected = false;
        
        const SYSTEM_PROMPT = `You are a website builder AI. You receive natural language commands and return ONLY valid JavaScript code that modifies the webpage.

Your response must ALWAYS be pure JavaScript code that can be executed with eval(). No explanations, no markdown, no code blocks - just executable JavaScript.

Available variables:
- canvas: the main div container
- document.body: the body element

Rules:
1. Return ONLY executable JavaScript code
2. Use DOM manipulation (createElement, appendChild, etc.)
3. Add "fade-in" class to new elements
4. Set inline styles with element.style.cssText
5. For colors, fonts, backgrounds, modify document.body.style
6. Return empty string if command is unclear

Examples:

User: "create a black background"
Your response: document.body.style.backgroundColor = 'black';

User: "add a hero section saying Hello World"
Your response: const section = document.createElement('div'); section.className = 'fade-in'; section.style.cssText = 'padding: 60px 20px; text-align: center; font-size: 48px; font-weight: bold;'; section.textContent = 'Hello World'; canvas.appendChild(section);

User: "text color white"
Your response: document.body.style.color = 'white';

User: "add a blue button that says Click Me"
Your response: const btn = document.createElement('button'); btn.className = 'fade-in'; btn.textContent = 'Click Me'; btn.style.cssText = 'padding: 15px 30px; font-size: 18px; margin: 20px; border: none; border-radius: 5px; background: blue; color: white; cursor: pointer;'; canvas.appendChild(btn);

Remember: ONLY return executable JavaScript code, nothing else.`;

        function showFeedback(message, isError = false) {
            feedback.textContent = message;
            feedback.style.display = 'block';
            feedback.style.background = isError ? 'rgba(220, 53, 69, 0.9)' : 'rgba(40, 167, 69, 0.9)';
            setTimeout(() => feedback.style.display = 'none', 3000);
        }
        
        function updateScore(points) {
            currentScore = Math.min(100, currentScore + points);
            scoreElement.textContent = currentScore;
            scoreDisplay.style.display = 'block';
        }
        
        async function testConnection() {
            const url = ollamaUrl.value.trim();
            showFeedback('Testing connection...');
            
            try {
                const response = await fetch(`${url}/api/tags`, {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                if (response.ok) {
                    isConnected = true;
                    statusIndicator.className = 'status-indicator status-connected';
                    showFeedback('‚úÖ Connected to Ollama!');
                    input.disabled = false;
                } else {
                    throw new Error('Connection failed');
                }
            } catch (error) {
                isConnected = false;
                statusIndicator.className = 'status-indicator status-disconnected';
                showFeedback('‚ùå Cannot connect to Ollama. Check URL and server.', true);
                input.disabled = true;
            }
        }
        
        async function sendToOllama(userCommand) {
            const url = ollamaUrl.value.trim();
            const model = modelSelect.value;
            
            try {
                const response = await fetch(`${url}/api/generate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: model,
                        prompt: userCommand,
                        system: SYSTEM_PROMPT,
                        stream: false,
                        options: {
                            temperature: 0.3
                        }
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                return data.response.trim();
            } catch (error) {
                throw new Error(`Ollama error: ${error.message}`);
            }
        }
        
        async function processCommand(command) {
            command = command.trim();
            
            if (!command) return;
            
            // Check for finish command
            if (/this is done|finished|complete|i'm done/i.test(command)) {
                finishGame();
                return;
            }
            
            if (!isConnected) {
                showFeedback('‚ùå Not connected to Ollama. Click "Test Connection" first.', true);
                return;
            }
            
            showFeedback('ü§ñ AI is thinking...');
            input.disabled = true;
            
            try {
                const jsCode = await sendToOllama(command);
                
                // Clean up the response (remove code blocks if AI added them)
                let cleanCode = jsCode.replace(/```javascript\n?/g, '').replace(/```\n?/g, '').trim();
                
                if (!cleanCode) {
                    showFeedback('‚ö†Ô∏è AI returned empty response. Try rephrasing.', true);
                    input.disabled = false;
                    return;
                }
                
                // Execute the code
                try {
                    eval(cleanCode);
                    commands.push(command);
                    updateScore(10);
                    showFeedback('‚úÖ Command executed!');
                } catch (execError) {
                    console.error('Execution error:', execError);
                    console.log('Code received:', cleanCode);
                    showFeedback('‚ö†Ô∏è Code execution failed. AI response may be invalid.', true);
                }
                
            } catch (error) {
                console.error('Error:', error);
                showFeedback(`‚ùå ${error.message}`, true);
            } finally {
                input.disabled = false;
            }
        }
        
        function calculateFinalScore() {
            let score = currentScore;
            
            // Bonus for variety
            const uniqueTypes = new Set();
            if (document.body.style.backgroundColor) uniqueTypes.add('background');
            if (canvas.querySelector('div')) uniqueTypes.add('section');
            if (canvas.querySelector('button')) uniqueTypes.add('button');
            if (canvas.querySelector('h1, h2, h3')) uniqueTypes.add('heading');
            if (canvas.querySelector('p')) uniqueTypes.add('paragraph');
            
            const varietyBonus = uniqueTypes.size * 5;
            score += varietyBonus;
            
            return Math.min(100, score);
        }
        
        function finishGame() {
            input.style.display = 'none';
            
            const finalScore = calculateFinalScore();
            scoreElement.textContent = finalScore;
            
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.95);
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                color: white;
                z-index: 10001;
                animation: fadeIn 0.5s ease-in;
            `;
            
            let rating = '';
            let comment = '';
            
            if (finalScore >= 80) {
                rating = 'üåü Outstanding!';
                comment = 'You\'ve built an impressive website with AI!';
            } else if (finalScore >= 60) {
                rating = 'üëç Great Job!';
                comment = 'Nice work! Your website has good structure.';
            } else if (finalScore >= 40) {
                rating = '‚úì Good Start!';
                comment = 'You\'re on the right track. Try more commands!';
            } else {
                rating = 'üí™ Keep Trying!';
                comment = 'Experiment with more commands to build a richer page.';
            }
            
            overlay.innerHTML = `
                <h1 style="font-size: 72px; margin-bottom: 20px;">${finalScore}/100</h1>
                <h2 style="font-size: 36px; margin-bottom: 20px;">${rating}</h2>
                <p style="font-size: 20px; text-align: center; max-width: 600px; margin-bottom: 30px;">${comment}</p>
                <button onclick="location.reload()" style="padding: 15px 40px; font-size: 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">
                    Play Again
                </button>
            `;
            
            document.body.appendChild(overlay);
        }
        
        // Event Listeners
        document.getElementById('testConnection').addEventListener('click', testConnection);
        
        input.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                processCommand(input.value);
                input.value = '';
            }
        });
        
        // Initial connection test
        input.disabled = true;
        setTimeout(testConnection, 500);
    </script>
</body>
</html>
